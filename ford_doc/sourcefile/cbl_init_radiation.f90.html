<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for CABLE">
    <meta name="author" content="CABLE community" >
    <link rel="icon" href="../favicon.png">

    <title>cbl_init_radiation.F90 &ndash; CABLE</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">CABLE </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
            <li><a href="../lists/programs.html">Programs</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>cbl_init_radiation.F90
    <small>Source File</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.4% of total for source files.">213 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/cbl_init_radiation.F90"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li class="active">cbl_init_radiation.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      <a class="list-group-item" href="../module/cbl_init_radiation_module.html">cbl_init_radiation_module</a>
    </div>
  </div>
</div>
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/cbl_init_radiation.f90.html#src">cbl_init_radiation.F90</a>
  </div>
</div>

</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: sourcefile~~cbl_init_radiation.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilecbl_init_radiationf90EfferentGraph" width="241pt" height="74pt"
 viewBox="0.00 0.00 241.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~cbl_init_radiation.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~cbl_init_radiation.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-70 237,-70 237,4 -4,4"/>
<!-- sourcefile~cbl_init_radiation.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~cbl_init_radiation.f90</title>
<polygon fill="none" stroke="black" points="233,-45 118,-45 118,-21 233,-21 233,-45"/>
<text text-anchor="middle" x="175.5" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50">cbl_init_radiation.F90</text>
</g>
<!-- sourcefile~cbl_rhoch.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~cbl_rhoch.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/cbl_rhoch.f90.html" xlink:title="cbl_rhoch.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="81.5,-66 0.5,-66 0.5,-42 81.5,-42 81.5,-66"/>
<text text-anchor="middle" x="41" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cbl_rhoch.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cbl_init_radiation.f90&#45;&gt;sourcefile~cbl_rhoch.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~cbl_init_radiation.f90&#45;&gt;sourcefile~cbl_rhoch.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M117.92,-41.97C109.13,-43.36 100.1,-44.79 91.47,-46.16"/>
<polygon fill="#ff0000" stroke="#ff0000" points="90.91,-42.71 81.58,-47.73 92,-49.62 90.91,-42.71"/>
</g>
<!-- sourcefile~cbl_spitter.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~cbl_spitter.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/cbl_spitter.f90.html" xlink:title="cbl_spitter.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="82,-24 0,-24 0,0 82,0 82,-24"/>
<text text-anchor="middle" x="41" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cbl_spitter.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cbl_init_radiation.f90&#45;&gt;sourcefile~cbl_spitter.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~cbl_init_radiation.f90&#45;&gt;sourcefile~cbl_spitter.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M117.92,-24.03C109.42,-22.69 100.7,-21.3 92.35,-19.98"/>
<polygon fill="#ff0000" stroke="#ff0000" points="92.79,-16.51 82.37,-18.4 91.69,-23.42 92.79,-16.51"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: sourcefile~~cbl_init_radiation.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilecbl_init_radiationf90AfferentGraph" width="609pt" height="200pt"
 viewBox="0.00 0.00 609.00 200.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 196)">
<title>sourcefile~~cbl_init_radiation.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-196 605,-196 605,4 -4,4"/>
<!-- sourcefile~cbl_init_radiation.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~cbl_init_radiation.f90</title>
<polygon fill="none" stroke="black" points="115,-87 0,-87 0,-63 115,-63 115,-87"/>
<text text-anchor="middle" x="57.5" y="-72.6" font-family="Helvetica,sans-Serif" font-size="10.50">cbl_init_radiation.F90</text>
</g>
<!-- sourcefile~cbl_model_driver_offline.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~cbl_model_driver_offline.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/cbl_model_driver_offline.f90.html" xlink:title="cbl_model_driver_offline.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="302,-108 151,-108 151,-84 302,-84 302,-108"/>
<text text-anchor="middle" x="226.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cbl_model_driver_offline.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cbl_model_driver_offline.f90&#45;&gt;sourcefile~cbl_init_radiation.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~cbl_model_driver_offline.f90&#45;&gt;sourcefile~cbl_init_radiation.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M150.79,-86.61C142.27,-85.53 133.63,-84.45 125.22,-83.39"/>
<polygon fill="#ff0000" stroke="#ff0000" points="125.47,-79.89 115.11,-82.12 124.59,-86.84 125.47,-79.89"/>
</g>
<!-- sourcefile~cable_cbm.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~cable_cbm.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/cable_cbm.f90.html" xlink:title="cable_cbm.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="269.5,-66 183.5,-66 183.5,-42 269.5,-42 269.5,-66"/>
<text text-anchor="middle" x="226.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_cbm.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_cbm.f90&#45;&gt;sourcefile~cbl_init_radiation.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~cable_cbm.f90&#45;&gt;sourcefile~cbl_init_radiation.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M183.36,-59.3C165.75,-61.51 144.86,-64.14 125.25,-66.61"/>
<polygon fill="#ff0000" stroke="#ff0000" points="124.63,-63.16 115.14,-67.88 125.5,-70.1 124.63,-63.16"/>
</g>
<!-- sourcefile~cable_mpimaster.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~cable_mpimaster.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/cable_mpimaster.f90.html" xlink:title="cable_mpimaster.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="460.5,-192 345.5,-192 345.5,-168 460.5,-168 460.5,-192"/>
<text text-anchor="middle" x="403" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_mpimaster.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_mpimaster.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~cable_mpimaster.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M361.25,-167.99C353.42,-165.31 345.38,-162.27 338,-159 308.5,-145.91 276.68,-127.24 254.79,-113.62"/>
<polygon fill="#ff0000" stroke="#ff0000" points="256.39,-110.49 246.06,-108.13 252.66,-116.41 256.39,-110.49"/>
</g>
<!-- sourcefile~cable_driver.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~cable_driver.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/cable_driver.f90.html" xlink:title="cable_driver.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="449,-108 357,-108 357,-84 449,-84 449,-108"/>
<text text-anchor="middle" x="403" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_driver.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_driver.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~cable_driver.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M356.61,-96C342.94,-96 327.48,-96 312.12,-96"/>
<polygon fill="#ff0000" stroke="#ff0000" points="312.06,-92.5 302.06,-96 312.06,-99.5 312.06,-92.5"/>
</g>
<!-- sourcefile~cable_explicit_driver.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~cable_explicit_driver.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/cable_explicit_driver.f90.html" xlink:title="cable_explicit_driver.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="468,-66 338,-66 338,-42 468,-42 468,-66"/>
<text text-anchor="middle" x="403" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_explicit_driver.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_explicit_driver.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~cable_explicit_driver.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M352,-66.04C331.82,-70.89 308.38,-76.53 287.32,-81.6"/>
<polygon fill="#ff0000" stroke="#ff0000" points="286.42,-78.22 277.51,-83.96 288.05,-85.03 286.42,-78.22"/>
</g>
<!-- sourcefile~cable_mpiworker.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~cable_mpiworker.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/cable_mpiworker.f90.html" xlink:title="cable_mpiworker.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="460.5,-150 345.5,-150 345.5,-126 460.5,-126 460.5,-150"/>
<text text-anchor="middle" x="403" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_mpiworker.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_mpiworker.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~cable_mpiworker.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M352,-125.96C331.82,-121.11 308.38,-115.47 287.32,-110.4"/>
<polygon fill="#ff0000" stroke="#ff0000" points="288.05,-106.97 277.51,-108.04 286.42,-113.78 288.05,-106.97"/>
</g>
<!-- sourcefile~cable_implicit_driver.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~cable_implicit_driver.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/cable_implicit_driver.f90.html" xlink:title="cable_implicit_driver.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="468,-24 338,-24 338,0 468,0 468,-24"/>
<text text-anchor="middle" x="403" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_implicit_driver.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_implicit_driver.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~cable_implicit_driver.f90&#45;&gt;sourcefile~cbl_model_driver_offline.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M355.15,-24.03C349.13,-26.52 343.25,-29.49 338,-33 317.57,-46.67 322.72,-61.76 302,-75 299.23,-76.77 296.3,-78.4 293.28,-79.89"/>
<polygon fill="#ff0000" stroke="#ff0000" points="291.73,-76.75 283.97,-83.97 294.54,-83.16 291.73,-76.75"/>
</g>
<!-- sourcefile~cable_mpidrv.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~cable_mpidrv.f90</title>
<g id="a_sourcefile~~cbl_init_radiation.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/cable_mpidrv.f90.html" xlink:title="cable_mpidrv.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="601,-171 504,-171 504,-147 601,-147 601,-171"/>
<text text-anchor="middle" x="552.5" y="-156.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_mpidrv.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_mpidrv.f90&#45;&gt;sourcefile~cable_mpimaster.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~cable_mpidrv.f90&#45;&gt;sourcefile~cable_mpimaster.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M503.61,-165.82C493.11,-167.31 481.81,-168.92 470.73,-170.5"/>
<polygon fill="#ff0000" stroke="#ff0000" points="470.05,-167.06 460.64,-171.94 471.03,-173.99 470.05,-167.06"/>
</g>
<!-- sourcefile~cable_mpidrv.f90&#45;&gt;sourcefile~cable_mpiworker.f90 -->
<g id="sourcefile~~cbl_init_radiation.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~cable_mpidrv.f90&#45;&gt;sourcefile~cable_mpiworker.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M503.61,-152.18C493.11,-150.69 481.81,-149.08 470.73,-147.5"/>
<polygon fill="#0066ff" stroke="#0066ff" points="471.03,-144.01 460.64,-146.06 470.05,-150.94 471.03,-144.01"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
<br>
    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      <a class="list-group-item" href="../module/cbl_init_radiation_module.html">cbl_init_radiation_module</a>
    </div>
  </div>
</div>
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/cbl_init_radiation.f90.html#src">cbl_init_radiation.F90</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a id="ln-1" name="ln-1" href="#ln-1"></a><span class="c">!==============================================================================</span>
<a id="ln-2" name="ln-2" href="#ln-2"></a><span class="c">! This source code is part of the</span>
<a id="ln-3" name="ln-3" href="#ln-3"></a><span class="c">! Australian Community Atmosphere Biosphere Land Exchange (CABLE) model.</span>
<a id="ln-4" name="ln-4" href="#ln-4"></a><span class="c">! This work is licensed under the CSIRO Open Source Software License</span>
<a id="ln-5" name="ln-5" href="#ln-5"></a><span class="c">! Agreement (variation of the BSD / MIT License).</span>
<a id="ln-6" name="ln-6" href="#ln-6"></a><span class="c">!</span>
<a id="ln-7" name="ln-7" href="#ln-7"></a><span class="c">! You may not use this file except in compliance with this License.</span>
<a id="ln-8" name="ln-8" href="#ln-8"></a><span class="c">! A copy of the License (CSIRO_BSD_MIT_License_v2.0_CABLE.txt) is located</span>
<a id="ln-9" name="ln-9" href="#ln-9"></a><span class="c">! in each directory containing CABLE code.</span>
<a id="ln-10" name="ln-10" href="#ln-10"></a><span class="c">!</span>
<a id="ln-11" name="ln-11" href="#ln-11"></a><span class="c">! ==============================================================================</span>
<a id="ln-12" name="ln-12" href="#ln-12"></a><span class="c">! Purpose: Computes radiation absorbed by canopy and soil surface</span>
<a id="ln-13" name="ln-13" href="#ln-13"></a><span class="c">!</span>
<a id="ln-14" name="ln-14" href="#ln-14"></a><span class="c">! Contact: Yingping.Wang@csiro.au</span>
<a id="ln-15" name="ln-15" href="#ln-15"></a><span class="c">!</span>
<a id="ln-16" name="ln-16" href="#ln-16"></a><span class="c">! History: No significant change from v1.4b</span>
<a id="ln-17" name="ln-17" href="#ln-17"></a><span class="c">!</span>
<a id="ln-18" name="ln-18" href="#ln-18"></a><span class="c">!</span>
<a id="ln-19" name="ln-19" href="#ln-19"></a><span class="c">! ==============================================================================</span>
<a id="ln-20" name="ln-20" href="#ln-20"></a>
<a id="ln-21" name="ln-21" href="#ln-21"></a><span class="k">MODULE </span><span class="n">cbl_init_radiation_module</span><span class="w"></span>
<a id="ln-22" name="ln-22" href="#ln-22"></a>
<a id="ln-23" name="ln-23" href="#ln-23"></a><span class="w">   </span><span class="k">IMPLICIT NONE</span>
<a id="ln-24" name="ln-24" href="#ln-24"></a>
<a id="ln-25" name="ln-25" href="#ln-25"></a><span class="k">   PUBLIC </span><span class="n">init_radiation</span><span class="w"></span>
<a id="ln-26" name="ln-26" href="#ln-26"></a><span class="w">   </span><span class="k">PRIVATE</span><span class="w"></span>
<a id="ln-27" name="ln-27" href="#ln-27"></a>
<a id="ln-28" name="ln-28" href="#ln-28"></a><span class="c">!FUDGED local pars -masks tuned at other times - review conssitency!!</span>
<a id="ln-29" name="ln-29" href="#ln-29"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ccoszen_tols_huge</span><span class="w">  </span><span class="c">! 1e-4 * threshold cosine of sun&#39;s zenith angle, below which considered SUNLIT</span>
<a id="ln-30" name="ln-30" href="#ln-30"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ccoszen_tols_tiny</span><span class="w">  </span><span class="c">! 1e-4 * threshold cosine of sun&#39;s zenith angle, below which considered SUNLIT</span>
<a id="ln-31" name="ln-31" href="#ln-31"></a>
<a id="ln-32" name="ln-32" href="#ln-32"></a><span class="k">CONTAINS</span>
<a id="ln-33" name="ln-33" href="#ln-33"></a>
<a id="ln-34" name="ln-34" href="#ln-34"></a><span class="k">SUBROUTINE </span><span class="n">init_radiation</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-35" name="ln-35" href="#ln-35"></a><span class="w">                        </span><span class="n">EffExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">EffExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">RadFbeam</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-36" name="ln-36" href="#ln-36"></a><span class="w">                        </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">rhoch</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w">                                         </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-37" name="ln-37" href="#ln-37"></a><span class="w">                        </span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">,</span><span class="w">                                                </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-38" name="ln-38" href="#ln-38"></a><span class="w">                        </span><span class="n">Clai_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">Ccoszen_tols</span><span class="p">,</span><span class="w"> </span><span class="n">CGauss_w</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi180</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-39" name="ln-39" href="#ln-39"></a><span class="w">                        </span><span class="n">cbl_standalone</span><span class="p">,</span><span class="w"> </span><span class="n">jls_standalone</span><span class="p">,</span><span class="w"> </span><span class="n">jls_radiation</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-40" name="ln-40" href="#ln-40"></a><span class="w">                        </span><span class="n">subr_name</span><span class="p">,</span><span class="w">                                             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-41" name="ln-41" href="#ln-41"></a><span class="w">                        </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_mask</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-42" name="ln-42" href="#ln-42"></a><span class="w">                        </span><span class="n">VegXfang</span><span class="p">,</span><span class="w"> </span><span class="n">VegTaul</span><span class="p">,</span><span class="w"> </span><span class="n">VegRefl</span><span class="p">,</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-43" name="ln-43" href="#ln-43"></a><span class="w">                        </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">metDoY</span><span class="p">,</span><span class="w"> </span><span class="n">SW_down</span><span class="p">,</span><span class="w">                               </span><span class="p">&amp;</span><span class="w"> </span>
<a id="ln-44" name="ln-44" href="#ln-44"></a><span class="w">                        </span><span class="n">reducedLAIdue2snow</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-45" name="ln-45" href="#ln-45"></a>
<a id="ln-46" name="ln-46" href="#ln-46"></a><span class="k">implicit none</span><span class="w"></span>
<a id="ln-47" name="ln-47" href="#ln-47"></a>
<a id="ln-48" name="ln-48" href="#ln-48"></a><span class="c">!re-decl input args</span>
<a id="ln-49" name="ln-49" href="#ln-49"></a><span class="c">!model dimensions</span>
<a id="ln-50" name="ln-50" href="#ln-50"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w">                   </span><span class="c">!total number of &quot;tiles&quot;  </span>
<a id="ln-51" name="ln-51" href="#ln-51"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w">                  </span><span class="c">!number of radiation bands [per legacy=3, but really=2 VIS,NIR. 3rd dim was for LW]</span>
<a id="ln-52" name="ln-52" href="#ln-52"></a>
<a id="ln-53" name="ln-53" href="#ln-53"></a><span class="c">!returned variables</span>
<a id="ln-54" name="ln-54" href="#ln-54"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">       </span><span class="c">!&quot;raw&quot; Extinction co-efficient for Direct Beam component of SW radiation</span>
<a id="ln-55" name="ln-55" href="#ln-55"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">        </span><span class="c">!&quot;raw&quot;Extinction co-efficient for Diffuse component of SW radiation</span>
<a id="ln-56" name="ln-56" href="#ln-56"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">EffExtCoeff_beam</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="c">!Effective Extinction co-efficient for Direct Beam component of SW radiation</span>
<a id="ln-57" name="ln-57" href="#ln-57"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">EffExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"> </span><span class="c">!Effective Extinction co-efficient for Diffuse component of SW radiation</span>
<a id="ln-58" name="ln-58" href="#ln-58"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RadFbeam</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">        </span><span class="c">!Beam Fraction of Downward SW radiation [formerly rad%fbeam]</span>
<a id="ln-59" name="ln-59" href="#ln-59"></a>
<a id="ln-60" name="ln-60" href="#ln-60"></a>
<a id="ln-61" name="ln-61" href="#ln-61"></a><span class="c">!constants</span>
<a id="ln-62" name="ln-62" href="#ln-62"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Clai_thresh</span><span class="w">             </span><span class="c">!threshold LAI below which considered UN-vegetated</span>
<a id="ln-63" name="ln-63" href="#ln-63"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ccoszen_tols</span><span class="w">            </span><span class="c">!threshold cosine of sun&#39;s zenith angle, below which considered SUNLIT</span>
<a id="ln-64" name="ln-64" href="#ln-64"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cgauss_w</span><span class="p">(</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-65" name="ln-65" href="#ln-65"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cpi</span><span class="w">                     </span><span class="c">!PI - from cable_math_constants originally</span>
<a id="ln-66" name="ln-66" href="#ln-66"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cpi180</span><span class="w">                  </span><span class="c">!PI in radians - from cable_math_constants originally</span>
<a id="ln-67" name="ln-67" href="#ln-67"></a><span class="c">!what model am i in</span>
<a id="ln-68" name="ln-68" href="#ln-68"></a><span class="kt">LOGICAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cbl_standalone</span><span class="w">       </span><span class="c">!runtime switch defined in cable_*main routines signifying this is cable_standalone</span>
<a id="ln-69" name="ln-69" href="#ln-69"></a><span class="kt">LOGICAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jls_standalone</span><span class="w">       </span><span class="c">!runtime switch defined in cable_*main routines signifying this is jules_standalone</span>
<a id="ln-70" name="ln-70" href="#ln-70"></a><span class="kt">LOGICAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jls_radiation</span><span class="w">        </span><span class="c">!runtime switch defined in cable_*main routines signifying this is the radiation pathway </span>
<a id="ln-71" name="ln-71" href="#ln-71"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">subr_name</span><span class="w"> </span><span class="c">!where am i called from</span>
<a id="ln-72" name="ln-72" href="#ln-72"></a><span class="c">!masks</span>
<a id="ln-73" name="ln-73" href="#ln-73"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">         </span><span class="c">!vegetated mask [formed by comparrisson of LAI CLAI_thresh ]</span>
<a id="ln-74" name="ln-74" href="#ln-74"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">      </span><span class="c">!sunlit mask [formed by comparrisson of coszen to coszen_tols i.e. is the sun up]</span>
<a id="ln-75" name="ln-75" href="#ln-75"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">  </span><span class="c">!combined mask - BOTH sunlit and vegetated</span>
<a id="ln-76" name="ln-76" href="#ln-76"></a>
<a id="ln-77" name="ln-77" href="#ln-77"></a><span class="c">!vegetation parameters input via namelist</span>
<a id="ln-78" name="ln-78" href="#ln-78"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-79" name="ln-79" href="#ln-79"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegTaul</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-80" name="ln-80" href="#ln-80"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegRefl</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-81" name="ln-81" href="#ln-81"></a>
<a id="ln-82" name="ln-82" href="#ln-82"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">  </span><span class="c">!Effective LAI given (potential sno coverage)</span>
<a id="ln-83" name="ln-83" href="#ln-83"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">coszen</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">              </span><span class="c">! cosine zenith angle of sun</span>
<a id="ln-84" name="ln-84" href="#ln-84"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SW_down</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">         </span><span class="c">!Downward SW radiation [formerly met%fsd]</span>
<a id="ln-85" name="ln-85" href="#ln-85"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">metDoY</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">           </span><span class="c">!Day of the Year [formerly met%doy]</span>
<a id="ln-86" name="ln-86" href="#ln-86"></a>
<a id="ln-87" name="ln-87" href="#ln-87"></a><span class="c">!co-efficients used throughout init_radiation used in albedo as well</span>
<a id="ln-88" name="ln-88" href="#ln-88"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c1</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-89" name="ln-89" href="#ln-89"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rhoch</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-90" name="ln-90" href="#ln-90"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xk</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">              </span><span class="c">! extinct. coef.for beam rad. and black leaves</span>
<a id="ln-91" name="ln-91" href="#ln-91"></a>
<a id="ln-92" name="ln-92" href="#ln-92"></a><span class="c">!local_vars - common scaling co-efficients used throughout init_radiation</span>
<a id="ln-93" name="ln-93" href="#ln-93"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"> </span><span class="c">! 2D vlai</span>
<a id="ln-94" name="ln-94" href="#ln-94"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi1</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">      </span><span class="c">! leaf angle parmameter 1</span>
<a id="ln-95" name="ln-95" href="#ln-95"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi2</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">      </span><span class="c">! leaf angle parmameter 2</span>
<a id="ln-96" name="ln-96" href="#ln-96"></a><span class="w">   </span>
<a id="ln-97" name="ln-97" href="#ln-97"></a><span class="c">!Null Initializations</span>
<a id="ln-98" name="ln-98" href="#ln-98"></a><span class="n">ExtCoeff_beam</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-99" name="ln-99" href="#ln-99"></a><span class="n">ExtCoeff_dif</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-100" name="ln-100" href="#ln-100"></a><span class="n">EffExtCoeff_beam</span><span class="p">(:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-101" name="ln-101" href="#ln-101"></a><span class="n">EffExtCoeff_dif</span><span class="p">(:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-102" name="ln-102" href="#ln-102"></a><span class="n">RadFbeam</span><span class="p">(:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-103" name="ln-103" href="#ln-103"></a><span class="n">c1</span><span class="p">(:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-104" name="ln-104" href="#ln-104"></a><span class="n">rhoch</span><span class="p">(:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-105" name="ln-105" href="#ln-105"></a><span class="n">xk</span><span class="p">(:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-106" name="ln-106" href="#ln-106"></a>
<a id="ln-107" name="ln-107" href="#ln-107"></a><span class="c">! Compute common scaling co-efficients used throughout init_radiation</span>
<a id="ln-108" name="ln-108" href="#ln-108"></a><span class="k">call </span><span class="n">Common_InitRad_Scalings</span><span class="p">(</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">rhoch</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-109" name="ln-109" href="#ln-109"></a><span class="w">                            </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi180</span><span class="p">,</span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-110" name="ln-110" href="#ln-110"></a><span class="w">                            </span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">,</span><span class="w"> </span><span class="n">VegTaul</span><span class="p">,</span><span class="w"> </span><span class="n">VegRefl</span><span class="p">)</span><span class="w"></span>
<a id="ln-111" name="ln-111" href="#ln-111"></a>
<a id="ln-112" name="ln-112" href="#ln-112"></a><span class="c">!Limiting Initializations for stability</span>
<a id="ln-113" name="ln-113" href="#ln-113"></a><span class="n">Ccoszen_tols_huge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ccoszen_tols</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e2</span><span class="w"> </span>
<a id="ln-114" name="ln-114" href="#ln-114"></a><span class="n">Ccoszen_tols_tiny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ccoszen_tols</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e-2</span><span class="w"> </span>
<a id="ln-115" name="ln-115" href="#ln-115"></a>
<a id="ln-116" name="ln-116" href="#ln-116"></a><span class="c">! Define Raw extinction co-efficients for direct beam/diffuse radiation</span>
<a id="ln-117" name="ln-117" href="#ln-117"></a><span class="c">! Largely parametrized per PFT. Does depend on zenith angle and effective LAI </span>
<a id="ln-118" name="ln-118" href="#ln-118"></a><span class="c">! [Formerly rad%extkb, rad%extkd]  </span>
<a id="ln-119" name="ln-119" href="#ln-119"></a><span class="k">call </span><span class="n">ExtinctionCoeff</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-120" name="ln-120" href="#ln-120"></a><span class="w">                      </span><span class="n">CGauss_w</span><span class="p">,</span><span class="n">Ccoszen_tols_tiny</span><span class="p">,</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-121" name="ln-121" href="#ln-121"></a><span class="w">                      </span><span class="n">sunlit_mask</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-122" name="ln-122" href="#ln-122"></a><span class="w">                      </span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">)</span><span class="w"></span>
<a id="ln-123" name="ln-123" href="#ln-123"></a>
<a id="ln-124" name="ln-124" href="#ln-124"></a><span class="c">! Define effective Extinction co-efficient for direct beam/diffuse radiation</span>
<a id="ln-125" name="ln-125" href="#ln-125"></a><span class="c">! Extincion Co-eff defined by parametrized leaf reflect(transmit)ance - used in</span>
<a id="ln-126" name="ln-126" href="#ln-126"></a><span class="c">! canopy transmitance calculations (cbl_albeo)</span>
<a id="ln-127" name="ln-127" href="#ln-127"></a><span class="c">! [Formerly rad%extkbm, rad%extkdm ]</span>
<a id="ln-128" name="ln-128" href="#ln-128"></a><span class="k">call </span><span class="n">EffectiveExtinctCoeffs</span><span class="p">(</span><span class="w"> </span><span class="n">EffExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">EffExtCoeff_dif</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-129" name="ln-129" href="#ln-129"></a><span class="w">                             </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-130" name="ln-130" href="#ln-130"></a><span class="w">                             </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-131" name="ln-131" href="#ln-131"></a>
<a id="ln-132" name="ln-132" href="#ln-132"></a><span class="c">! Offline/standalone forcing gives us total downward Shortwave. We have</span>
<a id="ln-133" name="ln-133" href="#ln-133"></a><span class="c">! previosuly, arbitratily split this into NIR/VIS (50/50). We use </span>
<a id="ln-134" name="ln-134" href="#ln-134"></a><span class="c">! Spitter function to split these bands into direct beam and diffuse components</span>
<a id="ln-135" name="ln-135" href="#ln-135"></a><span class="k">IF</span><span class="p">(</span><span class="w"> </span><span class="n">cbl_standalone</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">jls_standalone</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="w"> </span><span class="n">jls_radiation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-136" name="ln-136" href="#ln-136"></a><span class="w">  </span><span class="k">CALL </span><span class="n">BeamFraction</span><span class="p">(</span><span class="w"> </span><span class="n">RadFbeam</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi</span><span class="p">,</span><span class="w"> </span><span class="n">Ccoszen_tols_huge</span><span class="p">,</span><span class="w"> </span><span class="n">metDoy</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-137" name="ln-137" href="#ln-137"></a><span class="w">                     </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">SW_down</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<a id="ln-138" name="ln-138" href="#ln-138"></a><span class="w">   </span>
<a id="ln-139" name="ln-139" href="#ln-139"></a><span class="k">END SUBROUTINE </span><span class="n">init_radiation</span><span class="w"></span>
<a id="ln-140" name="ln-140" href="#ln-140"></a>
<a id="ln-141" name="ln-141" href="#ln-141"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-142" name="ln-142" href="#ln-142"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-143" name="ln-143" href="#ln-143"></a>
<a id="ln-144" name="ln-144" href="#ln-144"></a><span class="k">subroutine </span><span class="n">Common_InitRad_Scalings</span><span class="p">(</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">rhoch</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-145" name="ln-145" href="#ln-145"></a><span class="w">                            </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi180</span><span class="p">,</span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-146" name="ln-146" href="#ln-146"></a><span class="w">                            </span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-147" name="ln-147" href="#ln-147"></a><span class="w">                            </span><span class="n">VegXfang</span><span class="p">,</span><span class="w"> </span><span class="n">VegTaul</span><span class="p">,</span><span class="w"> </span><span class="n">VegRefl</span><span class="p">)</span><span class="w"></span>
<a id="ln-148" name="ln-148" href="#ln-148"></a><span class="c">!subrs</span>
<a id="ln-149" name="ln-149" href="#ln-149"></a><span class="k">USE </span><span class="n">cbl_rhoch_module</span><span class="p">,</span><span class="w">   </span><span class="k">ONLY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">calc_rhoch</span><span class="w"></span>
<a id="ln-150" name="ln-150" href="#ln-150"></a><span class="k">implicit none</span><span class="w"></span>
<a id="ln-151" name="ln-151" href="#ln-151"></a><span class="c">!re-decl in args</span>
<a id="ln-152" name="ln-152" href="#ln-152"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w"></span>
<a id="ln-153" name="ln-153" href="#ln-153"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w"></span>
<a id="ln-154" name="ln-154" href="#ln-154"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cpi180</span><span class="w"></span>
<a id="ln-155" name="ln-155" href="#ln-155"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cLAI_thresh</span><span class="w"></span>
<a id="ln-156" name="ln-156" href="#ln-156"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi1</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">    </span><span class="c">! leaf angle parmameter 1</span>
<a id="ln-157" name="ln-157" href="#ln-157"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi2</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">    </span><span class="c">! leaf angle parmameter 2</span>
<a id="ln-158" name="ln-158" href="#ln-158"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">  </span><span class="c">! 2D vlai</span>
<a id="ln-159" name="ln-159" href="#ln-159"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xk</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">      </span><span class="c">! extinct. coef.for beam rad. and black leaves</span>
<a id="ln-160" name="ln-160" href="#ln-160"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c1</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-161" name="ln-161" href="#ln-161"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rhoch</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-162" name="ln-162" href="#ln-162"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-163" name="ln-163" href="#ln-163"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-164" name="ln-164" href="#ln-164"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegTaul</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-165" name="ln-165" href="#ln-165"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegRefl</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-166" name="ln-166" href="#ln-166"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-167" name="ln-167" href="#ln-167"></a>
<a id="ln-168" name="ln-168" href="#ln-168"></a><span class="k">call </span><span class="n">common_InitRad_coeffs</span><span class="p">(</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi180</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-169" name="ln-169" href="#ln-169"></a><span class="w">                            </span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">,</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<a id="ln-170" name="ln-170" href="#ln-170"></a>
<a id="ln-171" name="ln-171" href="#ln-171"></a><span class="k">CALL </span><span class="n">calc_rhoch</span><span class="p">(</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="n">rhoch</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">VegTaul</span><span class="p">,</span><span class="w"> </span><span class="n">VegRefl</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-172" name="ln-172" href="#ln-172"></a>
<a id="ln-173" name="ln-173" href="#ln-173"></a><span class="k">End subroutine </span><span class="n">Common_InitRad_Scalings</span><span class="w"></span>
<a id="ln-174" name="ln-174" href="#ln-174"></a>
<a id="ln-175" name="ln-175" href="#ln-175"></a>
<a id="ln-176" name="ln-176" href="#ln-176"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-177" name="ln-177" href="#ln-177"></a>
<a id="ln-178" name="ln-178" href="#ln-178"></a><span class="k">subroutine  </span><span class="n">common_InitRad_coeffs</span><span class="p">(</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi180</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-179" name="ln-179" href="#ln-179"></a><span class="w">                            </span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">,</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<a id="ln-180" name="ln-180" href="#ln-180"></a>
<a id="ln-181" name="ln-181" href="#ln-181"></a>
<a id="ln-182" name="ln-182" href="#ln-182"></a><span class="k">implicit none</span><span class="w"></span>
<a id="ln-183" name="ln-183" href="#ln-183"></a><span class="c">!re-decl in args</span>
<a id="ln-184" name="ln-184" href="#ln-184"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w"></span>
<a id="ln-185" name="ln-185" href="#ln-185"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w"></span>
<a id="ln-186" name="ln-186" href="#ln-186"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cpi180</span><span class="w"></span>
<a id="ln-187" name="ln-187" href="#ln-187"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi1</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">    </span><span class="c">! leaf angle parmameter 1</span>
<a id="ln-188" name="ln-188" href="#ln-188"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi2</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">    </span><span class="c">! leaf angle parmameter 2</span>
<a id="ln-189" name="ln-189" href="#ln-189"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">  </span><span class="c">! 2D vlai</span>
<a id="ln-190" name="ln-190" href="#ln-190"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xk</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">      </span><span class="c">! extinct. coef.for beam rad. and black leaves</span>
<a id="ln-191" name="ln-191" href="#ln-191"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-192" name="ln-192" href="#ln-192"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-193" name="ln-193" href="#ln-193"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-194" name="ln-194" href="#ln-194"></a><span class="kt">real</span><span class="kd">::</span><span class="w"> </span><span class="n">cLAI_thresh</span><span class="w"></span>
<a id="ln-195" name="ln-195" href="#ln-195"></a>
<a id="ln-196" name="ln-196" href="#ln-196"></a><span class="c">!local vars</span>
<a id="ln-197" name="ln-197" href="#ln-197"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cos3</span><span class="p">(</span><span class="n">nrb</span><span class="p">)</span><span class="w">      </span><span class="c">! cos(15 45 75 degrees)</span>
<a id="ln-198" name="ln-198" href="#ln-198"></a>
<a id="ln-199" name="ln-199" href="#ln-199"></a><span class="n">cos3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">COS</span><span class="p">(</span><span class="n">CPI180</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">1</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="mf">5.0</span><span class="w"> </span><span class="o">/</span><span class="p">))</span><span class="w"></span>
<a id="ln-200" name="ln-200" href="#ln-200"></a>
<a id="ln-201" name="ln-201" href="#ln-201"></a><span class="w">  </span><span class="n">xphi1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-202" name="ln-202" href="#ln-202"></a><span class="w">  </span><span class="n">xphi2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-203" name="ln-203" href="#ln-203"></a><span class="w">  </span><span class="n">xvlai2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-204" name="ln-204" href="#ln-204"></a><span class="c">! See Sellers 1985, eq.13 (leaf angle parameters):</span>
<a id="ln-205" name="ln-205" href="#ln-205"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">veg_mask</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-206" name="ln-206" href="#ln-206"></a><span class="w">  </span><span class="n">xphi1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">VegXfang</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.633</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.33</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">VegXfang</span><span class="p">)</span><span class="w"></span>
<a id="ln-207" name="ln-207" href="#ln-207"></a><span class="w">  </span><span class="n">xphi2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.877</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xphi1</span><span class="p">)</span><span class="w"></span>
<a id="ln-208" name="ln-208" href="#ln-208"></a><span class="k">END WHERE</span><span class="w"></span>
<a id="ln-209" name="ln-209" href="#ln-209"></a>
<a id="ln-210" name="ln-210" href="#ln-210"></a><span class="c">! 2 dimensional LAI</span>
<a id="ln-211" name="ln-211" href="#ln-211"></a><span class="n">xvlai2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SPREAD</span><span class="p">(</span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-212" name="ln-212" href="#ln-212"></a>
<a id="ln-213" name="ln-213" href="#ln-213"></a><span class="c">! Extinction coefficient for beam radiation and black leaves;</span>
<a id="ln-214" name="ln-214" href="#ln-214"></a><span class="c">! eq. B6, Wang and Leuning, 1998</span>
<a id="ln-215" name="ln-215" href="#ln-215"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">xvlai2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cLAI_THRESH</span><span class="p">)</span><span class="w"> </span><span class="c">! vegetated</span>
<a id="ln-216" name="ln-216" href="#ln-216"></a><span class="w">   </span><span class="n">xk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SPREAD</span><span class="p">(</span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">SPREAD</span><span class="p">(</span><span class="n">cos3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">SPREAD</span><span class="p">(</span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-217" name="ln-217" href="#ln-217"></a><span class="n">ELSEWHERE</span><span class="w"> </span><span class="c">! i.e. bare soil</span>
<a id="ln-218" name="ln-218" href="#ln-218"></a><span class="w">   </span><span class="n">xk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-219" name="ln-219" href="#ln-219"></a><span class="k">END WHERE</span>
<a id="ln-220" name="ln-220" href="#ln-220"></a>
<a id="ln-221" name="ln-221" href="#ln-221"></a><span class="k">End subroutine </span><span class="n">common_InitRad_coeffs</span><span class="w"></span>
<a id="ln-222" name="ln-222" href="#ln-222"></a>
<a id="ln-223" name="ln-223" href="#ln-223"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-224" name="ln-224" href="#ln-224"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-225" name="ln-225" href="#ln-225"></a>
<a id="ln-226" name="ln-226" href="#ln-226"></a><span class="k">subroutine </span><span class="n">ExtinctionCoeff</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">CGauss_w</span><span class="p">,</span><span class="w"> </span><span class="n">Ccoszen_tols_tiny</span><span class="p">,</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-227" name="ln-227" href="#ln-227"></a><span class="w">                            </span><span class="n">sunlit_mask</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-228" name="ln-228" href="#ln-228"></a><span class="w">                            </span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">)</span><span class="w"></span>
<a id="ln-229" name="ln-229" href="#ln-229"></a>
<a id="ln-230" name="ln-230" href="#ln-230"></a><span class="k">implicit none</span><span class="w"></span>
<a id="ln-231" name="ln-231" href="#ln-231"></a><span class="c">!re-decl in args</span>
<a id="ln-232" name="ln-232" href="#ln-232"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w"></span>
<a id="ln-233" name="ln-233" href="#ln-233"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w"></span>
<a id="ln-234" name="ln-234" href="#ln-234"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">        </span><span class="c">!extinction co-eff RETURNED</span>
<a id="ln-235" name="ln-235" href="#ln-235"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">         </span><span class="c">!extinction co-eff RETURNED</span>
<a id="ln-236" name="ln-236" href="#ln-236"></a><span class="kt">logical</span><span class="kd">::</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">           </span><span class="c">!vegetated mask based on a minimum LAI </span>
<a id="ln-237" name="ln-237" href="#ln-237"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">       </span><span class="c">!sunlit mask based on zenith angle</span>
<a id="ln-238" name="ln-238" href="#ln-238"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">   </span><span class="c">!BOTH sunlit and vegetated mask </span>
<a id="ln-239" name="ln-239" href="#ln-239"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cgauss_w</span><span class="p">(</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-240" name="ln-240" href="#ln-240"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ccoszen_tols_tiny</span><span class="w">  </span><span class="c">! 1e-4 * threshold cosine of sun&#39;s zenith angle, below which considered SUNLIT</span>
<a id="ln-241" name="ln-241" href="#ln-241"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cLAI_thresh</span><span class="w"></span>
<a id="ln-242" name="ln-242" href="#ln-242"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">coszen</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-243" name="ln-243" href="#ln-243"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-244" name="ln-244" href="#ln-244"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi1</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-245" name="ln-245" href="#ln-245"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi2</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-246" name="ln-246" href="#ln-246"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">  </span><span class="c">! 2D vlai</span>
<a id="ln-247" name="ln-247" href="#ln-247"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xk</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">      </span><span class="c">! extinct. coef.for beam rad. and black leaves</span>
<a id="ln-248" name="ln-248" href="#ln-248"></a>
<a id="ln-249" name="ln-249" href="#ln-249"></a><span class="k">call </span><span class="n">ExtinctionCoeff_dif</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">CGauss_w</span><span class="p">,</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-250" name="ln-250" href="#ln-250"></a><span class="w">                          </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">)</span><span class="w"></span>
<a id="ln-251" name="ln-251" href="#ln-251"></a>
<a id="ln-252" name="ln-252" href="#ln-252"></a><span class="k">call </span><span class="n">ExtinctionCoeff_beam</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Ccoszen_tols_tiny</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-253" name="ln-253" href="#ln-253"></a><span class="w">                           </span><span class="n">sunlit_mask</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-254" name="ln-254" href="#ln-254"></a><span class="w">                           </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-255" name="ln-255" href="#ln-255"></a>
<a id="ln-256" name="ln-256" href="#ln-256"></a><span class="k">End subroutine </span><span class="n">ExtinctionCoeff</span><span class="w"></span>
<a id="ln-257" name="ln-257" href="#ln-257"></a>
<a id="ln-258" name="ln-258" href="#ln-258"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-259" name="ln-259" href="#ln-259"></a>
<a id="ln-260" name="ln-260" href="#ln-260"></a><span class="k">subroutine </span><span class="n">ExtinctionCoeff_beam</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="n">Ccoszen_tols_tiny</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-261" name="ln-261" href="#ln-261"></a><span class="w">                                 </span><span class="n">sunlit_mask</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-262" name="ln-262" href="#ln-262"></a><span class="w">                                 </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">xphi1</span><span class="p">,</span><span class="w"> </span><span class="n">xphi2</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-263" name="ln-263" href="#ln-263"></a>
<a id="ln-264" name="ln-264" href="#ln-264"></a><span class="k">implicit none</span>
<a id="ln-265" name="ln-265" href="#ln-265"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w"></span>
<a id="ln-266" name="ln-266" href="#ln-266"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w"></span>
<a id="ln-267" name="ln-267" href="#ln-267"></a>
<a id="ln-268" name="ln-268" href="#ln-268"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ccoszen_tols_tiny</span><span class="w">  </span><span class="c">! 1e-4 * threshold cosine of sun&#39;s zenith angle, below which considered SUNLIT</span>
<a id="ln-269" name="ln-269" href="#ln-269"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">       </span><span class="c">!sunlit mask based on zenith angle</span>
<a id="ln-270" name="ln-270" href="#ln-270"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">   </span><span class="c">!BOTH sunlit and vegetated mask </span>
<a id="ln-271" name="ln-271" href="#ln-271"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">coszen</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-272" name="ln-272" href="#ln-272"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-273" name="ln-273" href="#ln-273"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi1</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-274" name="ln-274" href="#ln-274"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xphi2</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-275" name="ln-275" href="#ln-275"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-276" name="ln-276" href="#ln-276"></a><span class="kt">logical</span><span class="kd">::</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-277" name="ln-277" href="#ln-277"></a>
<a id="ln-278" name="ln-278" href="#ln-278"></a><span class="c">! retain this initialization for bare soil</span>
<a id="ln-279" name="ln-279" href="#ln-279"></a><span class="n">ExtCoeff_beam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"></span>
<a id="ln-280" name="ln-280" href="#ln-280"></a>
<a id="ln-281" name="ln-281" href="#ln-281"></a><span class="c">! SW beam extinction coefficient (&quot;black&quot; leaves, extinction neglects</span>
<a id="ln-282" name="ln-282" href="#ln-282"></a><span class="c">! leaf SW transmittance and REFLectance):</span>
<a id="ln-283" name="ln-283" href="#ln-283"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">veg_mask</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">coszen</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.e-6</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-284" name="ln-284" href="#ln-284"></a><span class="w">  </span><span class="n">ExtCoeff_beam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xphi1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Coszen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xphi2</span><span class="w"></span>
<a id="ln-285" name="ln-285" href="#ln-285"></a>
<a id="ln-286" name="ln-286" href="#ln-286"></a><span class="c">! higher value precludes sunlit leaves at night. affects</span>
<a id="ln-287" name="ln-287" href="#ln-287"></a><span class="c">! nighttime evaporation - Ticket #90 </span>
<a id="ln-288" name="ln-288" href="#ln-288"></a><span class="k">WHERE</span><span class="p">(</span><span class="w"> </span><span class="n">coszen</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">1.e-6</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e5</span><span class="w"> </span>
<a id="ln-289" name="ln-289" href="#ln-289"></a>
<a id="ln-290" name="ln-290" href="#ln-290"></a>
<a id="ln-291" name="ln-291" href="#ln-291"></a><span class="c">! Seems to be for stability only</span>
<a id="ln-292" name="ln-292" href="#ln-292"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">ExtCoeff_beam</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.001</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-293" name="ln-293" href="#ln-293"></a><span class="w">  </span><span class="n">ExtCoeff_beam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.001</span><span class="w"></span>
<a id="ln-294" name="ln-294" href="#ln-294"></a>
<a id="ln-295" name="ln-295" href="#ln-295"></a><span class="k">End subroutine </span><span class="n">ExtinctionCoeff_beam</span><span class="w"></span>
<a id="ln-296" name="ln-296" href="#ln-296"></a>
<a id="ln-297" name="ln-297" href="#ln-297"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-298" name="ln-298" href="#ln-298"></a>
<a id="ln-299" name="ln-299" href="#ln-299"></a><span class="k">subroutine </span><span class="n">ExtinctionCoeff_dif</span><span class="p">(</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cgauss_w</span><span class="p">,</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">,</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-300" name="ln-300" href="#ln-300"></a><span class="w">                                 </span><span class="n">cLAI_thresh</span><span class="p">,</span><span class="w"> </span><span class="n">xk</span><span class="p">,</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">)</span><span class="w"></span>
<a id="ln-301" name="ln-301" href="#ln-301"></a><span class="k">implicit none</span>
<a id="ln-302" name="ln-302" href="#ln-302"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w"></span>
<a id="ln-303" name="ln-303" href="#ln-303"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w"></span>
<a id="ln-304" name="ln-304" href="#ln-304"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cgauss_w</span><span class="p">(</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-305" name="ln-305" href="#ln-305"></a>
<a id="ln-306" name="ln-306" href="#ln-306"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">    </span><span class="c">!return Extinctino Coefficient </span>
<a id="ln-307" name="ln-307" href="#ln-307"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-308" name="ln-308" href="#ln-308"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-309" name="ln-309" href="#ln-309"></a><span class="kt">real</span><span class="kd">::</span><span class="w"> </span><span class="n">cLAI_thresh</span><span class="w"></span>
<a id="ln-310" name="ln-310" href="#ln-310"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xvlai2</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">  </span><span class="c">! 2D vlai</span>
<a id="ln-311" name="ln-311" href="#ln-311"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xk</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">      </span><span class="c">! extinct. coef.for beam rad. and black leaves</span>
<a id="ln-312" name="ln-312" href="#ln-312"></a>
<a id="ln-313" name="ln-313" href="#ln-313"></a>
<a id="ln-314" name="ln-314" href="#ln-314"></a><span class="c">!local vars</span>
<a id="ln-315" name="ln-315" href="#ln-315"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cos3</span><span class="p">(</span><span class="n">nrb</span><span class="p">)</span><span class="w">      </span><span class="c">! cos(15 45 75 degrees)</span>
<a id="ln-316" name="ln-316" href="#ln-316"></a>
<a id="ln-317" name="ln-317" href="#ln-317"></a><span class="n">ExtCoeff_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.7</span><span class="w"></span>
<a id="ln-318" name="ln-318" href="#ln-318"></a>
<a id="ln-319" name="ln-319" href="#ln-319"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">veg_mask</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c">! vegetated</span>
<a id="ln-320" name="ln-320" href="#ln-320"></a><span class="w">  </span><span class="c">! Extinction coefficient for diffuse radiation for black leaves:</span>
<a id="ln-321" name="ln-321" href="#ln-321"></a><span class="w">  </span><span class="n">ExtCoeff_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">LOG</span><span class="p">(</span><span class="w"> </span><span class="nb">SUM</span><span class="p">(</span><span class="w">                                                   </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-322" name="ln-322" href="#ln-322"></a><span class="w">                            </span><span class="nb">SPREAD</span><span class="p">(</span><span class="w"> </span><span class="n">CGAUSS_W</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-323" name="ln-323" href="#ln-323"></a><span class="w">                            </span><span class="o">*</span><span class="w"> </span><span class="nb">EXP</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="n">xk</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xvlai2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-324" name="ln-324" href="#ln-324"></a><span class="w">                     </span><span class="p">)</span><span class="w">                                                         </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-325" name="ln-325" href="#ln-325"></a><span class="w">                     </span><span class="o">/</span><span class="w"> </span><span class="n">reducedLAIdue2snow</span><span class="w"></span>
<a id="ln-326" name="ln-326" href="#ln-326"></a>
<a id="ln-327" name="ln-327" href="#ln-327"></a><span class="w">   </span><span class="k">END WHERE</span>
<a id="ln-328" name="ln-328" href="#ln-328"></a><span class="k">End subroutine </span><span class="n">ExtinctionCoeff_dif</span><span class="w"></span>
<a id="ln-329" name="ln-329" href="#ln-329"></a>
<a id="ln-330" name="ln-330" href="#ln-330"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-331" name="ln-331" href="#ln-331"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-332" name="ln-332" href="#ln-332"></a>
<a id="ln-333" name="ln-333" href="#ln-333"></a><span class="k">Subroutine </span><span class="n">EffectiveExtinctCoeffs</span><span class="p">(</span><span class="w"> </span><span class="n">EffExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">EffExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-334" name="ln-334" href="#ln-334"></a><span class="w">                                   </span><span class="n">sunlit_veg_mask</span><span class="p">,</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-335" name="ln-335" href="#ln-335"></a><span class="w">                                   </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-336" name="ln-336" href="#ln-336"></a><span class="k">implicit none</span>
<a id="ln-337" name="ln-337" href="#ln-337"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w">                   </span><span class="c">!total number of &quot;tiles&quot;  </span>
<a id="ln-338" name="ln-338" href="#ln-338"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w">                  </span><span class="c">!number of radiation bands [per legacy=3, but really=2 VIS,NIR. 3rd dim was for LW]</span>
<a id="ln-339" name="ln-339" href="#ln-339"></a>
<a id="ln-340" name="ln-340" href="#ln-340"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">EffExtCoeff_beam</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="c">!Effective Extinction co-efficient for Direct Beam component of SW radiation</span>
<a id="ln-341" name="ln-341" href="#ln-341"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">EffExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"> </span><span class="c">!Effective Extinction co-efficient for Diffuse component of SW radiation</span>
<a id="ln-342" name="ln-342" href="#ln-342"></a>
<a id="ln-343" name="ln-343" href="#ln-343"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c1</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w"></span>
<a id="ln-344" name="ln-344" href="#ln-344"></a><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sunlit_veg_mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">  </span><span class="c">!combined mask - BOTH sunlit and vegetated</span>
<a id="ln-345" name="ln-345" href="#ln-345"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">       </span><span class="c">!&quot;raw&quot; Extinction co-efficient for Direct Beam component of SW radiation</span>
<a id="ln-346" name="ln-346" href="#ln-346"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">        </span><span class="c">!&quot;raw&quot;Extinction co-efficient for Diffuse component of SW radiation</span>
<a id="ln-347" name="ln-347" href="#ln-347"></a>
<a id="ln-348" name="ln-348" href="#ln-348"></a><span class="n">EffExtCoeff_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<a id="ln-349" name="ln-349" href="#ln-349"></a><span class="k">call </span><span class="n">EffectiveExtinctCoeff</span><span class="p">(</span><span class="w"> </span><span class="n">EffExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_dif</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-350" name="ln-350" href="#ln-350"></a>
<a id="ln-351" name="ln-351" href="#ln-351"></a><span class="n">EffExtCoeff_beam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<a id="ln-352" name="ln-352" href="#ln-352"></a><span class="k">call </span><span class="n">EffectiveExtinctCoeff</span><span class="p">(</span><span class="w"> </span><span class="n">EffExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff_beam</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-353" name="ln-353" href="#ln-353"></a><span class="w">                            </span><span class="n">sunlit_veg_mask</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-354" name="ln-354" href="#ln-354"></a><span class="k">End Subroutine </span><span class="n">EffectiveExtinctCoeffs</span><span class="w"></span>
<a id="ln-355" name="ln-355" href="#ln-355"></a>
<a id="ln-356" name="ln-356" href="#ln-356"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-357" name="ln-357" href="#ln-357"></a>
<a id="ln-358" name="ln-358" href="#ln-358"></a><span class="c">! modified k diffuse(6.20)(for leaf scattering)</span>
<a id="ln-359" name="ln-359" href="#ln-359"></a><span class="k">subroutine </span><span class="n">EffectiveExtinctCoeff</span><span class="p">(</span><span class="n">Eff_ExtCoeff</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">ExtCoeff</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-360" name="ln-360" href="#ln-360"></a><span class="k">implicit none</span>
<a id="ln-361" name="ln-361" href="#ln-361"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w"> </span>
<a id="ln-362" name="ln-362" href="#ln-362"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Eff_ExtCoeff</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span>
<a id="ln-363" name="ln-363" href="#ln-363"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ExtCoeff</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"> </span>
<a id="ln-364" name="ln-364" href="#ln-364"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c1</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span>
<a id="ln-365" name="ln-365" href="#ln-365"></a><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mask</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"> </span>
<a id="ln-366" name="ln-366" href="#ln-366"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<a id="ln-367" name="ln-367" href="#ln-367"></a>
<a id="ln-368" name="ln-368" href="#ln-368"></a><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">mp</span><span class="w"></span>
<a id="ln-369" name="ln-369" href="#ln-369"></a><span class="w">  </span><span class="k">DO </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<a id="ln-370" name="ln-370" href="#ln-370"></a><span class="w">    </span><span class="c">!IF mask is present we are doing the beam component then: </span>
<a id="ln-371" name="ln-371" href="#ln-371"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">present</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w"> </span>
<a id="ln-372" name="ln-372" href="#ln-372"></a><span class="w">      </span><span class="c">!then ONLY IF it is sunlit and vegetated -else default </span>
<a id="ln-373" name="ln-373" href="#ln-373"></a><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">mask</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Eff_ExtCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExtCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<a id="ln-374" name="ln-374" href="#ln-374"></a><span class="w">    </span><span class="k">else         </span>
<a id="ln-375" name="ln-375" href="#ln-375"></a><span class="k">      </span><span class="n">Eff_ExtCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExtCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w">          </span>
<a id="ln-376" name="ln-376" href="#ln-376"></a><span class="w">    </span><span class="k">endif</span>
<a id="ln-377" name="ln-377" href="#ln-377"></a>
<a id="ln-378" name="ln-378" href="#ln-378"></a><span class="k">  enddo</span>
<a id="ln-379" name="ln-379" href="#ln-379"></a><span class="k">enddo</span>
<a id="ln-380" name="ln-380" href="#ln-380"></a>
<a id="ln-381" name="ln-381" href="#ln-381"></a><span class="k">End subroutine </span><span class="n">EffectiveExtinctCoeff</span><span class="w"></span>
<a id="ln-382" name="ln-382" href="#ln-382"></a>
<a id="ln-383" name="ln-383" href="#ln-383"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-384" name="ln-384" href="#ln-384"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-385" name="ln-385" href="#ln-385"></a><span class="k">subroutine </span><span class="n">BeamFraction</span><span class="p">(</span><span class="w"> </span><span class="n">RadFbeam</span><span class="p">,</span><span class="w"> </span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">nrb</span><span class="p">,</span><span class="w"> </span><span class="n">Cpi</span><span class="p">,</span><span class="n">Ccoszen_tols_huge</span><span class="p">,</span><span class="w"> </span><span class="n">metDoy</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-386" name="ln-386" href="#ln-386"></a><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">SW_down</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<a id="ln-387" name="ln-387" href="#ln-387"></a><span class="k">USE </span><span class="n">cbl_spitter_module</span><span class="p">,</span><span class="w"> </span><span class="k">ONLY</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Spitter</span><span class="w"></span>
<a id="ln-388" name="ln-388" href="#ln-388"></a>
<a id="ln-389" name="ln-389" href="#ln-389"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w">                   </span><span class="c">!total number of &quot;tiles&quot;  </span>
<a id="ln-390" name="ln-390" href="#ln-390"></a><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nrb</span><span class="w">                  </span><span class="c">!number of radiation bands [per legacy=3, but really=2 VIS,NIR. 3rd dim was for LW]</span>
<a id="ln-391" name="ln-391" href="#ln-391"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RadFbeam</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">        </span><span class="c">!Beam Fraction of Downward SW radiation [formerly rad%fbeam]</span>
<a id="ln-392" name="ln-392" href="#ln-392"></a>
<a id="ln-393" name="ln-393" href="#ln-393"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Cpi</span><span class="w"> </span><span class="c">!PI - from cable_math_constants originally</span>
<a id="ln-394" name="ln-394" href="#ln-394"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Ccoszen_tols_huge</span><span class="w"> </span><span class="c">!PI - from cable_math_constants originally</span>
<a id="ln-395" name="ln-395" href="#ln-395"></a>
<a id="ln-396" name="ln-396" href="#ln-396"></a><span class="kt">integer</span><span class="kd">::</span><span class="w"> </span><span class="n">metDoY</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">          </span><span class="c">!Day of the Year [formerly met%doy]</span>
<a id="ln-397" name="ln-397" href="#ln-397"></a><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">coszen</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w">          </span><span class="c">!Day of the Year [formerly met%doy]</span>
<a id="ln-398" name="ln-398" href="#ln-398"></a><span class="kt">REAL</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SW_down</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">nrb</span><span class="p">)</span><span class="w">     </span><span class="c">!Downward SW radiation [formerly met%fsd]</span>
<a id="ln-399" name="ln-399" href="#ln-399"></a>
<a id="ln-400" name="ln-400" href="#ln-400"></a>
<a id="ln-401" name="ln-401" href="#ln-401"></a><span class="c">! Define beam fraction, fbeam:</span>
<a id="ln-402" name="ln-402" href="#ln-402"></a><span class="n">RadFbeam</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spitter</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">cpi</span><span class="p">,</span><span class="w"> </span><span class="n">metDoy</span><span class="p">,</span><span class="w"> </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">SW_down</span><span class="p">(:,</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<a id="ln-403" name="ln-403" href="#ln-403"></a><span class="n">RadfBeam</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spitter</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">cpi</span><span class="p">,</span><span class="w"> </span><span class="n">metDoy</span><span class="p">,</span><span class="w"> </span><span class="n">coszen</span><span class="p">,</span><span class="w"> </span><span class="n">SW_down</span><span class="p">(:,</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<a id="ln-404" name="ln-404" href="#ln-404"></a>
<a id="ln-405" name="ln-405" href="#ln-405"></a><span class="c">! coszen is set during met data read in.</span>
<a id="ln-406" name="ln-406" href="#ln-406"></a><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">coszen</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.e-2</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-407" name="ln-407" href="#ln-407"></a><span class="w">  </span><span class="n">RadFbeam</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-408" name="ln-408" href="#ln-408"></a><span class="w">  </span><span class="n">RadFbeam</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-409" name="ln-409" href="#ln-409"></a><span class="k">END WHERE</span>
<a id="ln-410" name="ln-410" href="#ln-410"></a>
<a id="ln-411" name="ln-411" href="#ln-411"></a><span class="k">End subroutine </span><span class="n">BeamFraction</span><span class="w"></span>
<a id="ln-412" name="ln-412" href="#ln-412"></a>
<a id="ln-413" name="ln-413" href="#ln-413"></a>
<a id="ln-414" name="ln-414" href="#ln-414"></a>
<a id="ln-415" name="ln-415" href="#ln-415"></a><span class="k">END MODULE </span><span class="n">cbl_init_radiation_module</span><span class="w"></span>
</pre></div>

    </section>
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>CABLE was developed by CABLE community<br>&copy; 2022 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>